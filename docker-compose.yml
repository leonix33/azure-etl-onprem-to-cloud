version: "3.9"

services:
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"

  rag-api:
    build:
      context: ./rag_api
    ports:
      - "8080:8080"
    environment:
      SEARCH_ENDPOINT: ${SEARCH_ENDPOINT}
      SEARCH_ADMIN_KEY: ${SEARCH_ADMIN_KEY}
      SEARCH_INDEX: ${SEARCH_INDEX:-etl-docs-index}
      OPENAI_ENDPOINT: ${OPENAI_ENDPOINT}
      OPENAI_KEY: ${OPENAI_KEY}
      OPENAI_DEPLOYMENT: ${OPENAI_DEPLOYMENT:-gpt-4o-mini}
      OPENAI_EMBEDDING_DEPLOYMENT: ${OPENAI_EMBEDDING_DEPLOYMENT:-text-embedding-3-small}
      SEARCH_FILTER: ${SEARCH_FILTER}
      RAG_API_KEY: ${RAG_API_KEY}
      JWT_SECRET: ${JWT_SECRET}
      JWT_ISSUER: ${JWT_ISSUER}
      JWT_AUDIENCE: ${JWT_AUDIENCE}
      REDIS_URL: redis://redis:6379/0
      RAG_RATE_LIMIT_PER_MIN: ${RAG_RATE_LIMIT_PER_MIN:-120}
    depends_on:
      - redis
